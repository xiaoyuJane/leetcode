package leetcode.editor.cn.DS.string;

//å®ç° strStr() å‡½æ•°ã€‚ 
//
// ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚
//æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1 ã€‚ 
//
// 
//
// è¯´æ˜ï¼š 
//
// å½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚ 
//
// å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸ C è¯­è¨€çš„ strstr() ä»¥åŠ Java çš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚ 
//
// 
//
// ç¤ºä¾‹ 1ï¼š 
//
// 
//è¾“å…¥ï¼šhaystack = "hello", needle = "ll"
//è¾“å‡ºï¼š2
// 
//
// ç¤ºä¾‹ 2ï¼š 
//
// 
//è¾“å…¥ï¼šhaystack = "aaaaa", needle = "bba"
//è¾“å‡ºï¼š-1
// 
//
// ç¤ºä¾‹ 3ï¼š 
//
// 
//è¾“å…¥ï¼šhaystack = "", needle = ""
//è¾“å‡ºï¼š0
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 0 <= haystack.length, needle.length <= 5 * 104 
// haystack å’Œ needle ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ 
// 
// Related Topics åŒæŒ‡é’ˆ å­—ç¬¦ä¸² å­—ç¬¦ä¸²åŒ¹é… 
// ğŸ‘ 1221 ğŸ‘ 0

//kmp ç®—æ³•--å‰ç¼€å‡½æ•° ï¼ˆå‚è€ƒé˜®ä¸€å³°çš„è®²è§£ï¼Œå¾ˆé€šä¿—æ˜“æ‡‚ï¼‰
// åŸä¸²åªå¾€å³ç§»ï¼Œä¸è¿›è¡Œå›æº¯ï¼Œå¯ä»¥æƒ³è±¡æˆåŸä¸²ä¸åŠ¨ï¼ŒåŒ¹é…ä¸²è·ŸéšåŸä¸²åŠ¨ï¼Œä¸»åŠ¨å»åŒ¹é…å®ƒ
// åŒ¹é…ä¸²ä¸­åˆ©ç”¨å‰ç¼€å’Œåç¼€è¿›è¡ŒåŠ å¿«åŒ¹é…ï¼Œå½“ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå­—ä¸²å¹¶éåªå‘å³ç§»åŠ¨1ä½ç»§ç»­åŒ¹é…ï¼Œè€Œæ˜¯å°†å­—ä¸²çš„å‰ç¼€ç§»åŠ¨åˆ°åŸä¸²çš„åç¼€ç›¸åŒä½ç½®ï¼Œå³ç§»åŠ¨{ç›¸åŒå­—ç¬¦-å‰ç¼€åç¼€æœ€å¤§äº¤é›†é•¿åº¦}ä½
//
//


public class ImplementStrstrKMP {
    public static void main(String[] args) {
        Solution solution = new ImplementStrstrKMP().new Solution();
    }
    
//leetcode submit region begin(Prohibit modification and deletion)
class Solution {
    public int strStr(String haystack, String needle) {

        if (needle.length() ==0) return 0;
        //1.æ‹¿åˆ°æœ€é•¿å‰åç¼€é•¿åº¦æ•°ç»„
        int[] next = Next(needle);
        //2.åŒæŒ‡é’ˆéå†ï¼ŒiæŒ‡å‘å­—ç¬¦ä¸²ï¼ŒjæŒ‡å‘æ¨¡å¼ä¸²,iå’Œjåœ¨ä¸€ä¸ªå¾ªç¯é‡Œæ§åˆ¶å˜é‡çš„å¢å€¼
        for (int i=0,j=0;i<haystack.length();i++){
            //å½“jä¸iåŒ¹é…ä¸Šäº†ï¼Œä½†ä¸æ˜¯å®Œå…¨åŒ¹é…ï¼Œ=>kmpçš„ç²¾é«“ï¼šiä½ç½®ä¸å˜ï¼Œç§»åŠ¨jä½ç½®åˆ°next[j-1]ä½ç½®ä¸Š
            while (j>0 && haystack.charAt(i)!=needle.charAt(j)){
                j=next[j-1];
            }
            //åªæœ‰ä¸ç»™å®šå­—ç¬¦ä¸²åŒ¹é…ä¸Šï¼Œjæ‰ä¼šç§»åŠ¨ï¼Œä¹Ÿè¡¨æ˜jä»£è¡¨æ¨¡å¼ä¸²åŒ¹é…ä¸Šçš„ä¸ªæ•°å€¼
            if (haystack.charAt(i) == needle.charAt(j)) j++;
            //åŒ¹é…ä¸Šçš„ä¸ªæ•°(j)ä¸ºæ¨¡å¼ä¸²çš„é•¿åº¦ï¼Œè¯´æ˜åŒ¹é…æˆåŠŸ
            if (j == needle.length()) return i-needle.length()+1;
        }

        return -1;
    }

    /*æ„é€ å‰ç¼€åç¼€æœ€å¤§äº¤é›†é•¿åº¦æ•°ç»„çš„è¿‡ç¨‹
     * len è¡¨ç¤ºprefixæ•°ç»„çš„å€¼
     * i è¡¨ç¤ºprefixæ•°ç»„çš„ä¸‹æ ‡
     */
    public int[] Next(String needle){
        int[]prefix = new int[needle.length()]; //åˆå§‹éƒ½ä¸º0
        //éå†æ¨¡å¼ä¸²æ•°ç»„ï¼Œæ‰¾åˆ°å…¶å‰ç¼€æ•°ç»„çš„æ¯ä¸ªlenå€¼ã€‚iä¸ºæ¸¸æ ‡ï¼Œä»1å¼€å§‹ï¼Œprefix[0]=0
        //lenä¸ºprefixæ•°ç»„å¯¹åº”çš„å€¼ï¼Œåˆè·Ÿæ¸¸æ ‡ç§»åŠ¨å¯†åˆ‡ç›¸å…³ã€‚lenæŒ‡å‘i-1ä½ç½®æœ€é•¿å‰ç¼€çš„æœ€åä¸€ä¸ªå€¼çš„ä¸‹ä¸€ä½ï¼Œå³å¯èƒ½æ˜¯iä½ç½®çš„æœ€é•¿å‰ç¼€å€¼
        //iä¸ºæ¨¡å¼ä¸²æ¸¸æ ‡ï¼Œä¹Ÿæ˜¯iä½ç½®æœ€é•¿åç¼€çš„æœ€åä¸€ä¸ªå€¼
        for (int i=1,len=0;i<needle.length();i++){

            //lenä¹Ÿä¸ºprefixæ•°ç»„å‰ä¸€ä¸ªä¸‹æ ‡çš„å€¼ len=prefix[i-1]ï¼Œè¡¨ç¤ºiä½ç½®è¦ä»prefix[i-1]å¼€å§‹æ£€æµ‹ï¼ˆç®—ä¸Šé¦–ä½ä¸‹æ ‡ä¸º0ï¼‰
            //1  å½“æ¸¸æ ‡å‰ä¸€ä½å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å‰ç¼€ï¼Œä½†æ˜¯åˆ°æ¸¸æ ‡å¤„å­—ç¬¦å¹¶æ²¡æœ‰æŒ‰ç…§é¢„æœŸï¼ˆlenä½ç½®ä¸iä½ç½®å­—ç¬¦ç›¸ç­‰ï¼Œåˆ™å‰ç¼€é•¿åº¦å¯åŠ 1ï¼Œå¦åˆ™ä¸èƒ½åŠ 1ï¼Œéœ€è¦é‡æ–°è®¡ç®—iä½ç½®å¯¹åº”çš„lenå€¼ï¼‰
            while (len>0 && needle.charAt(len)!=needle.charAt(i)){
                //å›é€€ç†è§£ï¼šå½“iä½ç½®é¢„æœŸä¸ç›¸ç­‰æ—¶ï¼Œæœ€é•¿ç›¸ç­‰å‰åç¼€ä¸å¯èƒ½å†ä¿æŒä¸ºlenäº†ï¼Œä¹Ÿä¸å¯èƒ½ä¸ºlen+1äº†ï¼Œéœ€è¦é‡æ–°æ‰¾lençš„åŒ¹é…ä½ç½®
                //ç”±äºåœ¨è¿™ä¸€å±‚é‡Œé¢ï¼Œiçš„ä½ç½®æ˜¯ä¸å˜çš„ï¼Œæ‰€ä»¥å®ƒæ‰¾çš„æ˜¯içš„æœ€é•¿åç¼€ï¼›
                // è§‚å¯Ÿå·²ç»æ¯”è¾ƒè¿‡çš„lenä¸ªé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œå®ƒæ˜¯ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„å­—ç¬¦ä¸²ï¼Œåˆ°iå¼€å§‹ä¸åŒï¼›
                // ä»¥è§‚å¯Ÿ[0,len-1]è¿™éƒ¨åˆ†å­—ç¬¦ä¸²ä¸ºä¾‹ï¼Œæ‰¾åˆ°å®ƒçš„æœ€é•¿å‰ç¼€å’Œæœ€é•¿åç¼€
                // æ–°lenä½ç½®ä¸º[0,len-1]è¿™éƒ¨åˆ†å­—ç¬¦ä¸²çš„æœ€é•¿å‰ç¼€ä¸‹ä¸ªä½ç½®ï¼Œä¸æœ€é•¿åç¼€çš„ä¸‹ä¸ªä½ç½®iè¿›è¡Œæ¯”è¾ƒ
                len=prefix[len-1];
            }

            //2.1 len=0 ä¸”iä½ç½®ä¸0ä½ç½®ç›¸ç­‰ï¼Œlen++;ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆlenç»§ç»­ä¸ºé»˜è®¤å€¼0
            //2.2 len>0 ä¸”iä½ç½®ä¸lenä½ç½®ç›¸ç­‰ï¼Œè¡¨ç¤ºå‰ç¼€é•¿åº¦åˆå¯ä»¥å¢åŠ 1äº†ï¼›ä¸ç›¸ç­‰èµ°1.1åˆ†æ”¯
            if (needle.charAt(len)==needle.charAt(i)) len++;

            //3. lenä¸ºprefixæ•°ç»„å¯¹åº”çš„å€¼
            prefix[i]=len;
        }

        return prefix;
    }
}
//leetcode submit region end(Prohibit modification and deletion)

}